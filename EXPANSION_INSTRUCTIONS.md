# Macro Expansion Instructions

This document explains how to view the expanded code generated by the netabase macros to verify that the keys function fixes are working correctly.

## Prerequisites

First, install the `cargo-expand` tool:

```bash
cargo install cargo-expand
```

## Basic Usage

To expand macro-generated code, use the following command format:

```bash
cargo expand --package <package_name> <module_path>::<item_name>
```

## Available Examples

The `test_macros` package contains comprehensive examples in the `expansion_examples` module that you can expand to view the generated code.

### Individual Schema Examples

#### Simple Struct
```bash
cargo expand --package test_macros expansion_examples::SimpleStructExample
```

#### Complex Struct with Multiple Field Types
```bash
cargo expand --package test_macros expansion_examples::ComplexStructExample
```

#### Tuple Struct (Unnamed Fields)
```bash
cargo expand --package test_macros expansion_examples::TupleStructExample
```

#### Unit Struct (No Fields)
```bash
cargo expand --package test_macros expansion_examples::UnitStructExample
```

#### Simple Enum with Mixed Variants
```bash
cargo expand --package test_macros expansion_examples::SimpleEnumExample
```

#### Complex Enum with Realistic Data
```bash
cargo expand --package test_macros expansion_examples::ComplexEnumExample
```

#### Generic Struct
```bash
cargo expand --package test_macros expansion_examples::GenericStructExample
```

#### Generic Enum
```bash
cargo expand --package test_macros expansion_examples::GenericEnumExample
```

### Schema Module Examples

#### Simple Schema Collection
```bash
cargo expand --package test_macros expansion_examples::simple_schemas_example::simple_schemas
```

#### Complex Schema with Generics and Nesting
```bash
cargo expand --package test_macros expansion_examples::complex_schemas_example::complex_schemas
```

#### Real-World Application Schemas
```bash
cargo expand --package test_macros expansion_examples::application_schemas_example::application_schemas
```

### Edge Cases

#### Empty Enum
```bash
cargo expand --package test_macros expansion_examples::EmptyEnum
```

#### Single Variant Enum
```bash
cargo expand --package test_macros expansion_examples::SingleVariantEnum
```

#### Multi-Generic Structure
```bash
cargo expand --package test_macros expansion_examples::MultiGeneric
```

### Expanding Entire Modules

You can also expand entire modules to see all generated code at once:

```bash
# Expand all expansion examples
cargo expand --package test_macros expansion_examples

# Expand a specific schema module
cargo expand --package test_macros expansion_examples::simple_schemas_example
```

## What to Look For

When viewing the expanded code, verify that the keys function fixes are working by checking:

### 1. Compilation Success
- **✅ Good**: All examples expand without errors
- **❌ Bad**: Compilation errors during expansion

### 2. Field Processing
- **✅ Good**: All struct fields are properly processed and included
- **✅ Good**: Named fields (`{ field: Type }`) are handled correctly
- **✅ Good**: Unnamed fields (`(Type1, Type2)`) are handled correctly
- **✅ Good**: Unit structs/variants (no fields) are handled gracefully
- **❌ Bad**: Missing fields in generated code
- **❌ Bad**: Malformed field processing

### 3. Enum Variant Processing
- **✅ Good**: All enum variants are included in generated code
- **✅ Good**: Mixed variant types (unit, tuple, struct) are handled
- **✅ Good**: Complex nested variants are processed correctly
- **❌ Bad**: Missing variants
- **❌ Bad**: Incorrectly processed variant fields

### 4. Schema Module Generation
- **✅ Good**: `NetabaseSchema` enum is generated with all schemas
- **✅ Good**: Generic parameters are preserved correctly
- **✅ Good**: Nested modules are processed
- **❌ Bad**: Missing schemas in generated enum
- **❌ Bad**: Malformed generic parameters

### 5. Type Safety
- **✅ Good**: Generated code has correct Rust syntax
- **✅ Good**: Type parameters and bounds are preserved
- **✅ Good**: All imports and paths are correct
- **❌ Bad**: Syntax errors in generated code
- **❌ Bad**: Incorrect or missing type information

## Example Output Analysis

Here's what you should see in the expanded output:

### For a Simple Struct:
```rust
#[derive(NetabaseSchema)]
pub struct SimpleStructExample {
    pub id: String,
    pub name: String,
    pub age: u32,
}
```

Should expand to show that all fields are properly processed and any generated trait implementations are syntactically correct.

### For an Enum:
```rust
#[derive(NetabaseSchema)]
pub enum SimpleEnumExample {
    UnitVariant,
    TupleVariant(String, u32),
    StructVariant { id: String, data: Vec<u8> },
}
```

Should expand to show that all three variant types are handled correctly.

### For a Schema Module:
```rust
#[schemas]
pub mod simple_schemas {
    #[derive(NetabaseSchema)]
    pub struct User { /* ... */ }
    
    #[derive(NetabaseSchema)]
    pub struct Post { /* ... */ }
}
```

Should expand to show a generated `NetabaseSchema` enum containing variants for each schema type.

## Troubleshooting

### Common Issues

#### 1. cargo-expand not found
```bash
# Install it
cargo install cargo-expand
```

#### 2. Module not found errors
```bash
# Make sure to use the correct module path
cargo expand --package test_macros expansion_examples::SimpleStructExample
#                    ^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
#                    package name   full module path
```

#### 3. Compilation errors during expansion
This usually indicates an issue with the macro logic. Check:
- The macro crate compiles: `cargo check -p netabase_macros`
- The test package compiles: `cargo check -p test_macros`

#### 4. Empty or malformed output
This may indicate issues with the keys function or visitor pattern. Compare with known working examples.

## Verifying Keys Function Fixes

The keys function fixes should be evident in the expansion by:

1. **No Compilation Errors**: All schemas expand successfully without syntax errors
2. **Complete Field Processing**: All fields in structs and enum variants are included
3. **Proper Type Handling**: Generic parameters and complex types are preserved
4. **Correct Visitor Pattern**: Enum variants and nested structures are processed
5. **Clean Generated Code**: The output is well-formed and syntactically correct

If any of these aspects fail, it may indicate remaining issues with the keys function implementation.

## Testing the Fixes

To verify that the keys function fixes are working:

1. Run the expansion examples compilation test:
   ```bash
   cargo test -p test_macros expansion_examples
   ```

2. Expand a few different examples and verify they produce clean output:
   ```bash
   cargo expand --package test_macros expansion_examples::SimpleStructExample
   cargo expand --package test_macros expansion_examples::ComplexEnumExample
   ```

3. Check that schema modules generate the expected enum:
   ```bash
   cargo expand --package test_macros expansion_examples::simple_schemas_example::simple_schemas
   ```

If all these work correctly, the keys function fixes are functioning as intended.